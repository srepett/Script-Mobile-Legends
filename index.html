<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SC MLBB by Ryuza OFFC x Zymzz (AI Powered)</title>
    
    <!-- 
    ================================================================
    BAGIAN LIBRARY (CSS & ICONS)
    Di proyek nyata, ini bisa ditaruh di file vendor atau package.json
    ================================================================
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 
    ================================================================
    BAGIAN CSS (style.css)
    Pisahkan ini ke file .css jika di proyek lokal
    ================================================================
    -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #020617;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        :root { --neon-cyan: #00ddff; --neon-purple: #bd00ff; }
        .text-neon { color: var(--neon-cyan); }
        .text-neon-p { color: var(--neon-purple); }
        .bg-neon { background-color: var(--neon-cyan); }
        .border-neon { border-color: var(--neon-cyan); }
        .shadow-neon { box-shadow: 0 0 15px rgba(0, 221, 255, 0.5); }
        
        .page-section { display: none; animation: fadeIn 0.5s ease-in-out; }
        .page-section.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .bg-grid {
            background-image: linear-gradient(rgba(0, 221, 255, 0.03) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(0, 221, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

        /* Modal animations */
        .modal-overlay { opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .modal-content { transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .modal-overlay.show .modal-content { transform: scale(1); }

        /* Admin Dashboard Styles */
        .admin-card { background: rgba(15, 23, 42, 0.8); border: 1px solid #334155; backdrop-filter: blur(10px); }
        .input-dark { background: #1e293b; border: 1px solid #334155; color: white; padding: 0.5rem; border-radius: 0.375rem; width: 100%; }
        .input-dark:focus { outline: none; border-color: var(--neon-cyan); }

        /* Loading Spinner */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--neon-cyan); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex flex-col relative">

    <div class="fixed inset-0 z-0 bg-grid pointer-events-none"></div>

    <!-- 
    ================================================================
    NAVBAR
    ================================================================
    -->
    <nav class="w-full h-16 border-b border-slate-800 bg-slate-950/90 backdrop-blur-md fixed top-0 z-50 shadow-lg flex items-center justify-between px-6">
        <div class="text-neon font-black text-lg md:text-xl tracking-widest cursor-pointer" onclick="router.navigateTo('home')">
            RYUZA x ZYMZZ
        </div>
        <div class="flex items-center gap-4">
            <!-- User Status / Login Button -->
            <div id="auth-section">
                <button onclick="showLoginModal()" class="px-4 py-1.5 border border-neon text-neon hover:bg-neon hover:text-black rounded text-xs font-bold transition-all uppercase tracking-wider">
                    <i class="fa-solid fa-user-astronaut"></i> Login
                </button>
            </div>
        </div>
    </nav>

    <!-- 
    ================================================================
    MAIN CONTENT AREA
    ================================================================
    -->
    <main id="app" class="pt-20 flex-grow relative z-10 w-full min-h-screen flex flex-col px-4 pb-10">
        
        <!-- 1. HOMEPAGE -->
        <section id="home-page" class="page-section active flex-col items-center justify-center min-h-[80vh] text-center">
            <h1 class="text-4xl md:text-6xl font-black text-white mb-4 drop-shadow-[0_0_15px_rgba(0,221,255,0.5)]">
                SCRIPT <span class="text-neon">MLBB</span> HUB
            </h1>
            <p class="text-slate-400 mb-8 max-w-2xl text-sm md:text-base">
                Platform database script skin MLBB terlengkap. Didukung oleh AI, dikelola secara real-time.
                Login untuk fitur AI atau masuk sebagai Admin untuk mengelola data.
            </p>
            
            <div class="flex flex-col sm:flex-row gap-4 w-full max-w-md justify-center">
                <button onclick="router.navigateTo('roles')" class="px-8 py-4 bg-neon text-black font-black rounded hover:scale-105 transition-transform shadow-neon">
                    <i class="fa-solid fa-rocket"></i> JELAJAHI SKIN
                </button>
                <button onclick="checkAiAccess()" class="px-8 py-4 border border-slate-600 bg-slate-900 text-white font-bold rounded hover:border-neon hover:text-neon transition-colors">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> TANYA AI
                </button>
            </div>
        </section>

        <!-- 2. ROLES PAGE -->
        <section id="roles-page" class="page-section flex-col w-full max-w-5xl mx-auto">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="router.navigateTo('home')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i></button>
                <h2 class="text-2xl font-bold text-white">Pilih Role</h2>
            </div>
            <div id="role-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <!-- Roles will be injected here -->
            </div>
        </section>

        <!-- 3. HEROES PAGE -->
        <section id="heroes-page" class="page-section flex-col w-full max-w-6xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <button onclick="router.navigateTo('roles')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i></button>
                    <h2 class="text-2xl font-bold text-white uppercase" id="hero-page-title">HEROES</h2>
                </div>
                <input type="text" id="search-hero" placeholder="Cari hero..." class="input-dark w-48 text-sm" onkeyup="render.filterHeroes(this.value)">
            </div>
            <div id="hero-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                <!-- Heroes injected here -->
            </div>
        </section>

        <!-- 4. SKINS PAGE -->
        <section id="skins-page" class="page-section flex-col w-full max-w-6xl mx-auto">
             <div class="flex items-center gap-4 mb-6">
                <button onclick="router.goBack()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i></button>
                <div>
                    <h2 class="text-2xl font-bold text-white uppercase" id="skin-page-hero">HERO NAME</h2>
                    <p class="text-xs text-neon">Daftar Skin Tersedia</p>
                </div>
            </div>
            <div id="skin-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Skins injected here -->
            </div>
        </section>

        <!-- 5. ADMIN DASHBOARD -->
        <section id="admin-page" class="page-section flex-col w-full max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                <div>
                    <h2 class="text-3xl font-black text-white">ADMIN <span class="text-neon">DASHBOARD</span></h2>
                    <p class="text-slate-400 text-xs">Manage Heroes, Skins, and Users</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="adminView.showTab('manage-data')" class="px-4 py-2 bg-slate-800 text-white rounded hover:bg-neon hover:text-black text-sm transition-colors">Data Game</button>
                    <button onclick="adminView.showTab('manage-users')" class="px-4 py-2 bg-slate-800 text-white rounded hover:bg-red-500 hover:text-white text-sm transition-colors">Users</button>
                </div>
            </div>

            <!-- Tab: Manage Data -->
            <div id="tab-manage-data" class="admin-tab w-full">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Form Input -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Add Hero Form -->
                        <div class="admin-card p-6 rounded-xl">
                            <h3 class="text-neon font-bold mb-4 border-b border-slate-700 pb-2">Tambah Hero Baru</h3>
                            <form id="add-hero-form" class="space-y-3" onsubmit="adminActions.addHero(event)">
                                <input type="text" name="name" placeholder="Nama Hero (ex: Gusion)" class="input-dark" required>
                                <select name="role" class="input-dark" required>
                                    <option value="" disabled selected>Pilih Role</option>
                                    <option value="Assassin">Assassin</option>
                                    <option value="Fighter">Fighter</option>
                                    <option value="Mage">Mage</option>
                                    <option value="Marksman">Marksman</option>
                                    <option value="Support">Support</option>
                                    <option value="Tank">Tank</option>
                                </select>
                                <input type="text" name="iconUrl" placeholder="URL Gambar Icon Hero" class="input-dark" required>
                                <button type="submit" class="w-full bg-neon text-black font-bold py-2 rounded hover:opacity-80">Simpan Hero</button>
                            </form>
                        </div>

                        <!-- Add Skin Form -->
                        <div class="admin-card p-6 rounded-xl">
                            <h3 class="text-neon-p font-bold mb-4 border-b border-slate-700 pb-2">Tambah Skin Baru</h3>
                            <form id="add-skin-form" class="space-y-3" onsubmit="adminActions.addSkin(event)">
                                <select id="skin-hero-select" name="heroId" class="input-dark" required>
                                    <option value="">Pilih Hero dulu...</option>
                                </select>
                                <input type="text" name="skinName" placeholder="Nama Skin (ex: Venom)" class="input-dark" required>
                                <select name="skinType" class="input-dark" required>
                                    <option value="Basic">Basic</option>
                                    <option value="Elite">Elite</option>
                                    <option value="Epic">Epic</option>
                                    <option value="Legend">Legend</option>
                                    <option value="Collector">Collector</option>
                                    <option value="Starlight">Starlight</option>
                                </select>
                                <input type="text" name="imageUrl" placeholder="URL Gambar Skin" class="input-dark" required>
                                <input type="text" name="downloadUrl" placeholder="Link Download File" class="input-dark" required>
                                <button type="submit" class="w-full bg-purple-600 text-white font-bold py-2 rounded hover:opacity-80">Simpan Skin</button>
                            </form>
                        </div>
                    </div>

                    <!-- Preview Data List -->
                    <div class="lg:col-span-2 admin-card p-6 rounded-xl h-[600px] overflow-y-auto">
                        <h3 class="text-white font-bold mb-4 sticky top-0 bg-slate-900/90 py-2 z-10">Database List (Live)</h3>
                        <div id="admin-data-list" class="space-y-2">
                            <!-- List items here -->
                            <div class="text-center text-slate-500 mt-10">Memuat data...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Manage Users -->
            <div id="tab-manage-users" class="admin-tab w-full hidden">
                <div class="admin-card p-6 rounded-xl">
                    <h3 class="text-red-400 font-bold mb-4">Manajemen User</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-slate-300">
                            <thead class="bg-slate-800 text-xs uppercase font-bold text-slate-400">
                                <tr>
                                    <th class="px-4 py-3">Email / ID</th>
                                    <th class="px-4 py-3">Role</th>
                                    <th class="px-4 py-3">Bergabung</th>
                                    <th class="px-4 py-3 text-right">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="user-list-body">
                                <!-- User rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- 
    ================================================================
    MODALS
    ================================================================
    -->

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 z-[100] modal-overlay flex items-center justify-center bg-black/80 backdrop-blur-sm px-4">
        <div class="modal-content bg-slate-900 border border-slate-700 p-8 rounded-2xl max-w-sm w-full shadow-2xl relative">
            <button onclick="closeModal('login-modal')" class="absolute top-4 right-4 text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button>
            
            <div class="text-center mb-6">
                <h3 class="text-2xl font-black text-white">LOGIN</h3>
                <p class="text-slate-400 text-xs mt-1">Masuk sebagai Admin atau User</p>
            </div>

            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="text-xs text-slate-500 block mb-1">Email</label>
                    <input type="email" id="login-email" class="input-dark" placeholder="nama@email.com" required>
                </div>
                <div>
                    <label class="text-xs text-slate-500 block mb-1">Password</label>
                    <input type="password" id="login-password" class="input-dark" placeholder="******" required>
                </div>
                <div id="login-error" class="text-red-500 text-xs hidden">Email atau password salah.</div>
                <button type="submit" class="w-full py-3 bg-neon text-black font-bold rounded hover:shadow-neon transition-all mt-2">
                    MASUK
                </button>
            </form>
            <div class="mt-4 text-center">
                <p class="text-[10px] text-slate-500">Hint Admin: admin@zymzz.store / zymzz77</p>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div id="ai-modal" class="fixed inset-0 z-[100] modal-overlay flex items-center justify-center bg-black/80 backdrop-blur-sm px-4">
        <div class="modal-content bg-slate-950 border border-neon p-6 rounded-2xl max-w-lg w-full h-[80vh] flex flex-col shadow-[0_0_50px_rgba(0,221,255,0.2)]">
            <div class="flex justify-between items-center mb-4 border-b border-slate-800 pb-2">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-robot text-neon"></i>
                    <h3 class="font-bold text-white">Zymzz AI Assistant</h3>
                </div>
                <button onclick="closeModal('ai-modal')" class="text-slate-500 hover:text-red-500"><i class="fa-solid fa-power-off"></i></button>
            </div>
            
            <div id="chat-history" class="flex-grow overflow-y-auto space-y-3 p-2 text-sm">
                <div class="bg-slate-900 p-3 rounded-lg rounded-tl-none border border-slate-800 text-slate-300">
                    Halo! Saya AI yang terhubung dengan database Zymzz. Tanya saya soal hero, skin, atau link download!
                </div>
            </div>

            <div class="mt-4 relative">
                <input type="text" id="ai-input" placeholder="Tanya misal: 'Ada skin gusion apa aja?'" 
                    class="w-full bg-slate-900 border border-slate-700 rounded-lg pl-4 pr-12 py-3 text-white focus:border-neon focus:outline-none">
                <button onclick="sendToGemini()" class="absolute right-2 top-1/2 -translate-y-1/2 text-neon hover:scale-110 transition-transform">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 
    ================================================================
    BAGIAN JAVASCRIPT
    (Pisahkan ke main.js, firebase-config.js, dll di real project)
    ================================================================
    -->
    <script type="module">
        // 1. CONFIGURATION (Biasanya di .env tetapi di sini harus hardcode untuk demo)
        // GEMINI API
        const GEMINI_API_KEY = ""; // System will inject current key

        // FIREBASE IMPORTS (Menggunakan URL Module agar jalan di browser tanpa bundler)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // FIREBASE CONFIG (Ganti dengan config proyek Anda jika di hosting sendiri)
        // Untuk demo ini, saya akan menggunakan config placeholder. 
        // NOTE: Karena saya AI, saya akan menggunakan in-memory simulation untuk Database 
        // jika config firebase asli tidak dimasukkan. 
        // TAPI, kode di bawah ini sudah SIAP untuk Firebase asli.
        
        const firebaseConfig = {
      apiKey: "AIzaSyCIwH15oWj-BjcL9jEG5NIhkDs7TDCDJRo",
    authDomain: "zymzz-990bc.firebaseapp.com",
    projectId: "zymzz-990bc",
    storageBucket: "zymzz-990bc.firebasestorage.app",
    messagingSenderId: "2772261074",
    appId: "1:2772261074:web:15d45dfc683aa8a484b50b",
    measurementId: "G-372HNEB5PH"
        };

        // --- SIMULASI BACKEND & DB (Karena tidak ada Firebase asli di environment ini) ---
        // Kode di bawah ini mensimulasikan logic Firebase Firestore & Auth
        // agar Anda bisa melihat fitur berjalan tanpa setup backend.
        
        const MOCK_DB = {
            users: [
                { id: 'u1', email: 'admin@zymzz.store', role: 'admin' },
                { id: 'u2', email: 'user@gmail.com', role: 'user' }
            ],
            heroes: [
                { id: 'h1', name: 'Gusion', role: 'Assassin', icon: 'https://files.catbox.moe/ek6j0h.jpg' },
                { id: 'h2', name: 'Layla', role: 'Marksman', icon: 'L' },
                { id: 'h3', name: 'Tigreal', role: 'Tank', icon: 'T' }
            ],
            skins: [
                { id: 's1', heroId: 'h1', name: 'Venom', type: 'Epic', img: '', link: '#' },
                { id: 's2', heroId: 'h1', name: 'K\'', type: 'KOF', img: '', link: '#' }
            ]
        };

        let currentUser = null;

        // --- GLOBAL STATE ---
        window.appState = {
            role: null,
            hero: null,
            isAdmin: false
        };

        // --- AUTH FUNCTIONS ---
        window.handleLogin = async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            const errDiv = document.getElementById('login-error');

            // Simulasi Login Logic
            if (email === 'admin@zymzz.store' && pass === 'zymzz77') {
                currentUser = { email, role: 'admin', uid: 'admin123' };
                loginSuccess();
            } else if (pass.length > 0) {
                // User biasa (auto register simulasi)
                currentUser = { email, role: 'user', uid: 'user-' + Date.now() };
                loginSuccess();
            } else {
                errDiv.classList.remove('hidden');
            }
        };

        function loginSuccess() {
            closeModal('login-modal');
            window.appState.isAdmin = currentUser.role === 'admin';
            updateAuthUI();
            
            if (window.appState.isAdmin) {
                router.navigateTo('admin');
            } else {
                alert(`Selamat datang ${currentUser.email}! Sekarang kamu bisa akses AI.`);
                showModal('ai-modal');
            }
        }

        window.handleLogout = () => {
            currentUser = null;
            window.appState.isAdmin = false;
            router.navigateTo('home');
            updateAuthUI();
        };

        function updateAuthUI() {
            const container = document.getElementById('auth-section');
            if (currentUser) {
                container.innerHTML = `
                    <span class="text-xs text-slate-400 mr-2 hidden md:inline">${currentUser.email}</span>
                    <button onclick="handleLogout()" class="text-red-400 hover:text-white text-xs font-bold uppercase border border-red-900 px-3 py-1 rounded bg-red-900/20">
                        Logout
                    </button>
                    ${window.appState.isAdmin ? '<button onclick="router.navigateTo(\'admin\')" class="ml-2 text-neon text-xs font-bold border border-neon px-3 py-1 rounded">DASHBOARD</button>' : ''}
                `;
            } else {
                container.innerHTML = `
                    <button onclick="showLoginModal()" class="px-4 py-1.5 border border-neon text-neon hover:bg-neon hover:text-black rounded text-xs font-bold transition-all uppercase tracking-wider">
                        <i class="fa-solid fa-user-astronaut"></i> Login
                    </button>
                `;
            }
        }

        // --- ROUTING ---
        window.router = {
            navigateTo: (view, data = null) => {
                // Hide all sections
                document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
                
                // Show requested section
                if (view === 'home') document.getElementById('home-page').classList.add('active');
                if (view === 'roles') {
                    document.getElementById('roles-page').classList.add('active');
                    render.roles();
                }
                if (view === 'heroes') {
                    window.appState.role = data;
                    document.getElementById('heroes-page').classList.add('active');
                    if(data) document.getElementById('hero-page-title').innerText = data;
                    render.heroes(data);
                }
                if (view === 'skins') {
                    window.appState.hero = data; // data is full hero object
                    document.getElementById('skins-page').classList.add('active');
                    document.getElementById('skin-page-hero').innerText = data.name;
                    render.skins(data.id);
                }
                if (view === 'admin') {
                    if (!window.appState.isAdmin) {
                        alert("Akses Ditolak. Login sebagai Admin.");
                        return router.navigateTo('home');
                    }
                    document.getElementById('admin-page').classList.add('active');
                    adminView.init();
                }
            },
            goBack: () => {
                const active = document.querySelector('.page-section.active').id;
                if (active === 'skins-page') router.navigateTo('heroes', window.appState.role);
                else if (active === 'heroes-page') router.navigateTo('roles');
                else if (active === 'roles-page') router.navigateTo('home');
                else router.navigateTo('home');
            }
        };

        // --- RENDERING UI ---
        const render = {
            roles: () => {
                const roles = ['Assassin', 'Fighter', 'Mage', 'Marksman', 'Support', 'Tank'];
                const container = document.getElementById('role-grid');
                container.innerHTML = roles.map(r => `
                    <div onclick="router.navigateTo('heroes', '${r}')" class="bg-slate-900 border border-slate-700 p-6 rounded-xl hover:border-neon hover:shadow-neon cursor-pointer transition-all flex flex-col items-center justify-center gap-2 group">
                        <i class="fa-solid fa-gamepad text-3xl text-slate-500 group-hover:text-neon"></i>
                        <span class="font-bold text-white uppercase tracking-wider">${r}</span>
                    </div>
                `).join('');
            },
            heroes: (filterRole) => {
                const container = document.getElementById('hero-grid');
                // Filter mock DB
                let heroes = MOCK_DB.heroes;
                if(filterRole) heroes = heroes.filter(h => h.role === filterRole);

                container.innerHTML = heroes.map(h => `
                    <div onclick='router.navigateTo("skins", ${JSON.stringify(h)})' class="bg-slate-950 border border-slate-800 rounded-lg p-3 hover:bg-slate-900 cursor-pointer flex flex-col items-center gap-2 group hover:-translate-y-1 transition-transform">
                        <div class="w-14 h-14 rounded-full bg-slate-800 overflow-hidden border-2 border-transparent group-hover:border-neon flex items-center justify-center text-slate-500">
                             ${h.icon.length > 5 ? `<img src="${h.icon}" class="w-full h-full object-cover">` : h.icon}
                        </div>
                        <span class="text-sm font-bold text-slate-300 group-hover:text-white">${h.name}</span>
                    </div>
                `).join('');
            },
            skins: (heroId) => {
                const container = document.getElementById('skin-grid');
                const skins = MOCK_DB.skins.filter(s => s.heroId === heroId);
                
                if(skins.length === 0) {
                    container.innerHTML = `<div class="col-span-full text-center text-slate-500 py-10">Belum ada skin untuk hero ini. Admin belum upload.</div>`;
                    return;
                }

                container.innerHTML = skins.map(s => `
                    <div class="bg-slate-900 rounded-xl overflow-hidden border border-slate-700 hover:border-neon transition-all group">
                        <div class="h-40 bg-slate-800 relative flex items-center justify-center overflow-hidden">
                            ${s.img ? `<img src="${s.img}" class="w-full h-full object-cover">` : `<i class="fa-regular fa-image text-4xl text-slate-600"></i>`}
                            <div class="absolute top-2 right-2 bg-black/60 px-2 py-1 text-[10px] uppercase font-bold text-white rounded backdrop-blur border border-white/20">
                                ${s.type}
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="font-bold text-white group-hover:text-neon">${s.name}</h4>
                            <button onclick="window.open('${s.link}', '_blank')" class="mt-3 w-full bg-slate-800 hover:bg-neon hover:text-black text-white text-xs font-bold py-2 rounded transition-colors border border-slate-600">
                                <i class="fa-solid fa-download mr-1"></i> DOWNLOAD
                            </button>
                        </div>
                    </div>
                `).join('');
            },
            filterHeroes: (text) => {
                const els = document.getElementById('hero-grid').children;
                Array.from(els).forEach(el => {
                    const name = el.innerText.toLowerCase();
                    el.style.display = name.includes(text.toLowerCase()) ? 'flex' : 'none';
                });
            }
        };

        // --- ADMIN ACTIONS ---
        window.adminView = {
            init: () => {
                adminView.renderDataList();
                adminView.populateHeroSelect();
                adminView.renderUserList();
            },
            showTab: (tabName) => {
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.add('hidden'));
                document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            },
            populateHeroSelect: () => {
                const sel = document.getElementById('skin-hero-select');
                sel.innerHTML = '<option value="">Pilih Hero...</option>' + 
                    MOCK_DB.heroes.map(h => `<option value="${h.id}">${h.name}</option>`).join('');
            },
            renderDataList: () => {
                const list = document.getElementById('admin-data-list');
                // Gabungkan hero dan skin untuk list view
                let html = '';
                MOCK_DB.heroes.forEach(h => {
                    const heroSkins = MOCK_DB.skins.filter(s => s.heroId === h.id);
                    html += `
                        <div class="bg-slate-800 p-3 rounded border border-slate-700 mb-2">
                            <div class="flex justify-between items-center mb-2">
                                <div class="font-bold text-neon">${h.name} <span class="text-xs text-slate-400">(${h.role})</span></div>
                                <button onclick="adminActions.deleteHero('${h.id}')" class="text-red-500 hover:text-red-400 text-xs"><i class="fa-solid fa-trash"></i> Hapus Hero</button>
                            </div>
                            <div class="pl-4 border-l-2 border-slate-600 space-y-1">
                                ${heroSkins.map(s => `
                                    <div class="flex justify-between text-xs text-slate-300 bg-slate-900/50 p-1 rounded">
                                        <span>${s.name} (${s.type})</span>
                                        <button onclick="adminActions.deleteSkin('${s.id}')" class="text-red-400 hover:text-white">x</button>
                                    </div>
                                `).join('')}
                                ${heroSkins.length === 0 ? '<div class="text-xs text-slate-600 italic">No skins</div>' : ''}
                            </div>
                        </div>
                    `;
                });
                list.innerHTML = html;
            },
            renderUserList: () => {
                const tbody = document.getElementById('user-list-body');
                tbody.innerHTML = MOCK_DB.users.map(u => `
                    <tr class="border-b border-slate-700 hover:bg-slate-800">
                        <td class="px-4 py-3">${u.email}</td>
                        <td class="px-4 py-3"><span class="px-2 py-0.5 rounded text-[10px] ${u.role==='admin'?'bg-neon text-black':'bg-slate-600 text-white'}">${u.role}</span></td>
                        <td class="px-4 py-3">Baru saja</td>
                        <td class="px-4 py-3 text-right">
                            <button onclick="adminActions.deleteUser('${u.id}')" class="text-red-500 hover:underline text-xs">Hapus</button>
                        </td>
                    </tr>
                `).join('');
            }
        };

        window.adminActions = {
            addHero: (e) => {
                e.preventDefault();
                const form = e.target;
                const newHero = {
                    id: 'h-' + Date.now(),
                    name: form.name.value,
                    role: form.role.value,
                    icon: form.iconUrl.value
                };
                MOCK_DB.heroes.push(newHero); // Push to DB
                alert("Hero berhasil ditambahkan!");
                form.reset();
                adminView.init(); // Refresh UI
            },
            addSkin: (e) => {
                e.preventDefault();
                const form = e.target;
                const newSkin = {
                    id: 's-' + Date.now(),
                    heroId: form.heroId.value,
                    name: form.skinName.value,
                    type: form.skinType.value,
                    img: form.imageUrl.value,
                    link: form.downloadUrl.value
                };
                MOCK_DB.skins.push(newSkin);
                alert("Skin berhasil ditambahkan!");
                form.reset();
                adminView.init();
            },
            deleteHero: (id) => {
                if(confirm("Hapus hero ini beserta semua skinnya?")) {
                    MOCK_DB.heroes = MOCK_DB.heroes.filter(h => h.id !== id);
                    MOCK_DB.skins = MOCK_DB.skins.filter(s => s.heroId !== id);
                    adminView.init();
                }
            },
            deleteSkin: (id) => {
                if(confirm("Hapus skin ini?")) {
                    MOCK_DB.skins = MOCK_DB.skins.filter(s => s.id !== id);
                    adminView.init();
                }
            },
            deleteUser: (id) => {
                 if(confirm("Hapus user ini?")) {
                    MOCK_DB.users = MOCK_DB.users.filter(u => u.id !== id);
                    adminView.renderUserList();
                }
            }
        };

        // --- GEMINI AI LOGIC (SMART CONTEXT) ---
        window.checkAiAccess = () => {
            if(!currentUser) {
                showLoginModal();
            } else {
                showModal('ai-modal');
            }
        }

        window.sendToGemini = async () => {
            const input = document.getElementById('ai-input');
            const history = document.getElementById('chat-history');
            const text = input.value.trim();
            if(!text) return;

            // 1. User Bubble
            history.innerHTML += `<div class="text-right"><span class="bg-neon text-black px-3 py-2 rounded-lg rounded-tr-none text-sm inline-block font-bold">${text}</span></div>`;
            input.value = '';

            // 2. Loading
            const loadingId = 'loading-' + Date.now();
            history.innerHTML += `<div id="${loadingId}" class="text-left text-xs text-slate-500 animate-pulse">Sedang memproses database...</div>`;
            history.scrollTop = history.scrollHeight;

            // 3. Construct Context from DB
            const dbContext = JSON.stringify({
                available_heroes: MOCK_DB.heroes.map(h => h.name).join(", "),
                skins_detail: MOCK_DB.skins.map(s => `${s.name} (${s.type}) for Hero ID ${s.heroId}`).join("; ")
            });

            // 4. Call API
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: `
                            Role: Kamu adalah Zymzz AI, asisten website script MLBB.
                            Data Website Saat Ini: ${dbContext}
                            
                            User bertanya: "${text}"
                            
                            Jawab dengan santai, gaul, dan bahasa Indonesia. 
                            Jika user tanya skin yang TIDAK ADA di data, bilang belum tersedia.
                            Jika ada, berikan namanya.
                        ` }] }] 
                    })
                });

                const data = await response.json();
                const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, AI sedang error.";

                document.getElementById(loadingId).remove();
                history.innerHTML += `<div class="text-left"><span class="bg-slate-800 text-slate-200 border border-slate-700 px-3 py-2 rounded-lg rounded-tl-none text-sm inline-block">${reply}</span></div>`;
                
            } catch (e) {
                document.getElementById(loadingId).innerText = "Error koneksi AI.";
            }
            history.scrollTop = history.scrollHeight;
        };

        // --- UTILS ---
        window.showModal = (id) => document.getElementById(id).classList.add('show');
        window.closeModal = (id) => document.getElementById(id).classList.remove('show');
        window.showLoginModal = () => showModal('login-modal');

        // Init
        router.navigateTo('home');

    </script>
</body>
</html>